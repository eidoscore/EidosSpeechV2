<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel ‚Äî eidosSpeech</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        :root {
            color-scheme: dark;
        }

        body {
            background: #030704;
            color: #e5e7eb;
            font-family: 'Inter', system-ui, sans-serif;
        }

        .card {
            background: rgba(255, 255, 255, .03);
            border: 1px solid rgba(255, 255, 255, .07);
        }

        .code-block {
            font-family: 'JetBrains Mono', monospace;
            background: #0d1117;
            border: 1px solid #21262d;
        }

        .nav-btn.active {
            background: rgba(16, 185, 129, .1);
            color: #10b981;
        }

        .nav-btn {
            color: #6b7280;
        }

        .nav-btn:hover {
            color: #d1d5db;
            background: rgba(255, 255, 255, .04);
        }

        table {
            border-collapse: collapse;
        }

        .status-ok {
            color: #10b981;
        }

        .status-err {
            color: #ef4444;
        }
    </style>
</head>

<body class="min-h-screen">

    <!-- Login overlay -->
    <div id="admin-login" class="fixed inset-0 z-50 flex items-center justify-center" style="background:#030704;">
        <div class="w-full max-w-sm">
            <div class="text-center mb-8">
                <div
                    class="w-12 h-12 bg-emerald-500/10 border border-emerald-500/20 rounded-2xl flex items-center justify-center mx-auto mb-4 text-2xl">
                    üõ°Ô∏è</div>
                <h1 class="text-xl font-bold text-white">Admin Access</h1>
                <p class="text-gray-500 text-sm mt-1">eidosSpeech Admin Panel</p>
            </div>
            <div class="card rounded-2xl p-6 space-y-4">
                <input id="admin-key-input" type="password" placeholder="X-Admin-Key"
                    class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2.5 text-sm text-white placeholder-gray-600 focus:outline-none focus:border-emerald-500/50 transition-colors"
                    onkeydown="if(event.key==='Enter')doAdminLogin()">
                <button onclick="doAdminLogin()"
                    class="w-full bg-emerald-500 hover:bg-emerald-400 text-white font-semibold py-2.5 rounded-xl transition-colors">
                    Enter Admin Panel
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="hidden flex h-screen">

        <!-- Sidebar -->
        <aside class="w-56 flex-shrink-0 border-r border-white/[.06] flex flex-col"
            style="background:rgba(5,10,6,.95);">
            <div class="h-14 flex items-center gap-2.5 px-4 border-b border-white/[.06]">
                <div
                    class="w-7 h-7 rounded-lg bg-emerald-500 flex items-center justify-center text-white font-bold text-xs">
                    e</div>
                <div>
                    <div class="text-sm font-bold text-white leading-none">eidosSpeech</div>
                    <div class="text-xs text-gray-600">Admin</div>
                </div>
            </div>
            <nav class="flex-1 p-3 space-y-0.5">
                <button
                    class="nav-btn active w-full text-left px-3 py-2 rounded-xl text-sm font-medium transition-colors"
                    onclick="showTab('overview', this)">üìä Overview</button>
                <button class="nav-btn w-full text-left px-3 py-2 rounded-xl text-sm font-medium transition-colors"
                    onclick="showTab('users', this)">üë• Users</button>
                <button class="nav-btn w-full text-left px-3 py-2 rounded-xl text-sm font-medium transition-colors"
                    onclick="showTab('usage', this)">üìà Usage</button>
                <button class="nav-btn w-full text-left px-3 py-2 rounded-xl text-sm font-medium transition-colors"
                    onclick="showTab('analytics', this)">üåç Analytics</button>
                <button class="nav-btn w-full text-left px-3 py-2 rounded-xl text-sm font-medium transition-colors"
                    onclick="showTab('blacklist', this)">üö´ Blacklist</button>
            </nav>
            <div class="p-3 border-t border-white/[.06]">
                <button onclick="doAdminLogout()"
                    class="w-full text-left px-3 py-2 rounded-xl text-sm text-gray-600 hover:text-gray-400 hover:bg-white/5 transition-colors">Sign
                    Out</button>
            </div>
        </aside>

        <!-- Main -->
        <div class="flex-1 flex flex-col overflow-hidden">

            <!-- Top bar -->
            <div class="h-14 border-b border-white/[.06] flex items-center justify-between px-6"
                style="background:rgba(5,10,6,.8)">
                <h1 id="page-title" class="text-sm font-semibold text-white">Overview</h1>
                <button onclick="loadCurrentTab()"
                    class="text-xs text-gray-500 hover:text-gray-300 bg-white/5 hover:bg-white/10 px-3 py-1.5 rounded-lg transition-colors">‚Üª
                    Refresh</button>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto p-6">

                <!-- Overview Tab -->
                <div id="tab-overview" class="space-y-6">
                    <!-- Stats Grid -->
                    <div class="grid grid-cols-2 lg:grid-cols-5 gap-4">
                        <div class="card rounded-xl p-4 text-center">
                            <div id="s-total-users" class="text-2xl font-black text-emerald-400">‚Äî</div>
                            <div class="text-xs text-gray-500 mt-1">Total Users</div>
                        </div>
                        <div class="card rounded-xl p-4 text-center">
                            <div id="s-verified" class="text-2xl font-black text-emerald-400">‚Äî</div>
                            <div class="text-xs text-gray-500 mt-1">Verified</div>
                        </div>
                        <div class="card rounded-xl p-4 text-center">
                            <div id="s-api-keys" class="text-2xl font-black text-emerald-400">‚Äî</div>
                            <div class="text-xs text-gray-500 mt-1">Active Keys</div>
                        </div>
                        <div class="card rounded-xl p-4 text-center">
                            <div id="s-req-today" class="text-2xl font-black text-emerald-400">‚Äî</div>
                            <div class="text-xs text-gray-500 mt-1">Req Today</div>
                        </div>
                        <div class="card rounded-xl p-4 text-center">
                            <div id="s-req-yday" class="text-2xl font-black text-gray-400">‚Äî</div>
                            <div class="text-xs text-gray-500 mt-1">Req Yesterday</div>
                        </div>
                    </div>

                    <!-- Additional Stats Row -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                        <div class="card rounded-xl p-5">
                            <h3 class="text-sm font-semibold text-white mb-3 flex items-center gap-2">
                                <span>üë•</span> User Activity
                            </h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Unverified</span>
                                    <span id="s-unverified" class="text-amber-400 font-mono">‚Äî</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Banned</span>
                                    <span id="s-banned" class="text-red-400 font-mono">‚Äî</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Verification Rate</span>
                                    <span id="s-verify-rate" class="text-emerald-400 font-mono">‚Äî</span>
                                </div>
                            </div>
                        </div>

                        <div class="card rounded-xl p-5">
                            <h3 class="text-sm font-semibold text-white mb-3 flex items-center gap-2">
                                <span>üìä</span> API Usage
                            </h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Avg Req/Day</span>
                                    <span id="s-avg-req" class="text-emerald-400 font-mono">‚Äî</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Peak Day</span>
                                    <span id="s-peak-req" class="text-emerald-400 font-mono">‚Äî</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Growth</span>
                                    <span id="s-growth" class="font-mono">‚Äî</span>
                                </div>
                            </div>
                        </div>

                        <div class="card rounded-xl p-5">
                            <h3 class="text-sm font-semibold text-white mb-3 flex items-center gap-2">
                                <span>üíæ</span> Cache Status
                            </h3>
                            <div id="s-cache" class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Files</span>
                                    <span id="s-cache-files" class="text-white font-mono">‚Äî</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Size</span>
                                    <span id="s-cache-size" class="text-white font-mono">‚Äî</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Usage</span>
                                    <span id="s-cache-percent" class="text-emerald-400 font-mono">‚Äî</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card rounded-xl p-5">
                        <h3 class="text-sm font-semibold text-white mb-3 flex items-center gap-2">
                            <span>‚ö°</span> Quick Actions
                        </h3>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="showTab('users', document.querySelectorAll('.nav-btn')[1])"
                                class="px-4 py-2 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-400 text-sm rounded-lg transition-colors border border-emerald-500/20">
                                View All Users
                            </button>
                            <button onclick="showTab('usage', document.querySelectorAll('.nav-btn')[2])"
                                class="px-4 py-2 bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 text-sm rounded-lg transition-colors border border-blue-500/20">
                                View Usage Analytics
                            </button>
                            <button onclick="showTab('blacklist', document.querySelectorAll('.nav-btn')[3])"
                                class="px-4 py-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 text-sm rounded-lg transition-colors border border-red-500/20">
                                Manage Blacklist
                            </button>
                        </div>
                    </div>

                    <!-- Usage Trend Chart -->
                    <div class="card rounded-xl p-5">
                        <h3 class="text-sm font-semibold text-white mb-4 flex items-center gap-2">
                            <span>üìà</span> Usage Trend (Last 7 Days)
                        </h3>
                        <div class="relative" style="height: 200px;">
                            <canvas id="overview-chart"></canvas>
                        </div>
                    </div>

                    <!-- System Info -->
                    <div class="card rounded-xl p-5">
                        <h3 class="text-sm font-semibold text-white mb-3 flex items-center gap-2">
                            <span>‚ÑπÔ∏è</span> System Information
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <div class="text-gray-500 mb-1">Character Limits</div>
                                <div class="text-gray-400 space-y-1 text-xs">
                                    <div>‚Ä¢ Anonymous (Web UI): 500 chars/request</div>
                                    <div>‚Ä¢ Registered (API): 1,000 chars/request</div>
                                    <div>‚Ä¢ Registered (Web UI): 2,000 chars/request</div>
                                </div>
                            </div>
                            <div>
                                <div class="text-gray-500 mb-1">Rate Limits</div>
                                <div class="text-gray-400 space-y-1 text-xs">
                                    <div>‚Ä¢ Anonymous: 5 requests/day</div>
                                    <div>‚Ä¢ Registered: 30 requests/day</div>
                                    <div>‚Ä¢ Resets daily at midnight UTC</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Tab -->
                <div id="tab-users" class="hidden space-y-4">
                    <div class="flex gap-2">
                        <input id="user-search" type="text" placeholder="Search by email‚Ä¶"
                            onkeydown="if(event.key==='Enter')loadUsers()"
                            class="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-sm text-white placeholder-gray-600 focus:outline-none focus:border-emerald-500/50 transition-colors">
                        <button onclick="loadUsers()"
                            class="bg-emerald-500 hover:bg-emerald-400 text-white px-4 rounded-xl text-sm font-medium transition-colors">Search</button>
                    </div>
                    <div class="card rounded-xl overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="border-b border-white/[.06]">
                                <tr>
                                    <th class="text-left text-xs text-gray-500 px-4 py-3">Email</th>
                                    <th class="text-left text-xs text-gray-500 px-4 py-3">Status</th>
                                    <th class="text-left text-xs text-gray-500 px-4 py-3">Usage Today</th>
                                    <th class="text-left text-xs text-gray-500 px-4 py-3">Joined</th>
                                    <th class="text-right text-xs text-gray-500 px-4 py-3">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-tbody" class="text-gray-400">
                                <tr>
                                    <td colspan="5" class="py-8 text-center text-gray-600 text-sm">Loading‚Ä¶</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="flex items-center justify-between text-xs text-gray-600">
                        <span id="users-total">‚Äî users</span>
                        <div class="flex gap-2">
                            <button onclick="prevPage()"
                                class="px-3 py-1 bg-white/5 hover:bg-white/10 rounded-lg transition-colors">‚Üê
                                Prev</button>
                            <button onclick="nextPage()"
                                class="px-3 py-1 bg-white/5 hover:bg-white/10 rounded-lg transition-colors">Next
                                ‚Üí</button>
                        </div>
                    </div>
                </div>

                <!-- Usage Tab -->
                <div id="tab-usage" class="hidden space-y-4">
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="card rounded-xl p-4">
                            <div class="text-xs text-gray-500 mb-1">Total Requests</div>
                            <div id="usage-total-req" class="text-2xl font-black text-emerald-400">‚Äî</div>
                        </div>
                        <div class="card rounded-xl p-4">
                            <div class="text-xs text-gray-500 mb-1">Total Characters</div>
                            <div id="usage-total-chars" class="text-2xl font-black text-blue-400">‚Äî</div>
                        </div>
                        <div class="card rounded-xl p-4">
                            <div class="text-xs text-gray-500 mb-1">Avg Requests/Day</div>
                            <div id="usage-avg-req" class="text-2xl font-black text-purple-400">‚Äî</div>
                        </div>
                    </div>

                    <div class="flex gap-2 items-center">
                        <label class="text-xs text-gray-500">Last</label>
                        <select id="usage-days" onchange="loadUsage()"
                            class="bg-white/5 border border-white/10 text-white text-sm rounded-lg px-3 py-1.5 focus:outline-none">
                            <option value="7">7 days</option>
                            <option value="14">14 days</option>
                            <option value="30" selected>30 days</option>
                            <option value="60">60 days</option>
                        </select>
                    </div>

                    <!-- Usage Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                        <div class="card rounded-xl p-5">
                            <h3 class="text-sm font-semibold text-white mb-4 flex items-center gap-2">
                                <span>üìä</span> Requests Over Time
                            </h3>
                            <div class="relative" style="height: 250px;">
                                <canvas id="requests-chart"></canvas>
                            </div>
                        </div>
                        <div class="card rounded-xl p-5">
                            <h3 class="text-sm font-semibold text-white mb-4 flex items-center gap-2">
                                <span>üìù</span> Characters Over Time
                            </h3>
                            <div class="relative" style="height: 250px;">
                                <canvas id="characters-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="card rounded-xl overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="border-b border-white/[.06]">
                                <tr>
                                    <th class="text-left text-xs text-gray-500 px-4 py-3">Date</th>
                                    <th class="text-left text-xs text-gray-500 px-4 py-3">Requests</th>
                                    <th class="text-left text-xs text-gray-500 px-4 py-3">Characters</th>
                                    <th class="text-left text-xs text-gray-500 px-4 py-3">Unique IPs</th>
                                </tr>
                            </thead>
                            <tbody id="usage-tbody" class="text-gray-400">
                                <tr>
                                    <td colspan="4" class="py-8 text-center text-gray-600 text-sm">Loading‚Ä¶</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div id="tab-analytics" class="hidden space-y-4">
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="card rounded-xl p-4">
                            <div class="text-xs text-gray-500 mb-1">Total Page Views</div>
                            <div id="analytics-total-views" class="text-2xl font-black text-emerald-400">‚Äî</div>
                            <div id="analytics-period-label" class="text-xs text-gray-600 mt-1">Last 30 days</div>
                        </div>
                        <div class="card rounded-xl p-4">
                            <div class="text-xs text-gray-500 mb-1">Unique Visitors</div>
                            <div id="analytics-total-visitors" class="text-2xl font-black text-blue-400">‚Äî</div>
                            <div id="analytics-period-label-2" class="text-xs text-gray-600 mt-1">Last 30 days</div>
                        </div>
                    </div>

                    <!-- Period Selector -->
                    <div class="flex gap-2 items-center">
                        <label class="text-xs text-gray-500">View:</label>
                        <select id="analytics-period" onchange="loadAnalytics()"
                            class="bg-white/5 border border-white/10 text-white text-sm rounded-lg px-3 py-1.5 focus:outline-none">
                            <option value="daily" selected>Last 30 Days (Daily)</option>
                            <option value="weekly">Last 12 Weeks (Weekly)</option>
                            <option value="monthly">Last 12 Months (Monthly)</option>
                        </select>
                    </div>

                    <!-- Traffic Chart -->
                    <div class="card rounded-xl p-5">
                        <h3 class="text-sm font-semibold text-white mb-4 flex items-center gap-2">
                            <span>üìä</span> Website Traffic
                        </h3>
                        <div class="relative" style="height: 300px;">
                            <canvas id="traffic-chart"></canvas>
                        </div>
                    </div>

                    <!-- Top Countries & Pages -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                        <!-- Top Countries -->
                        <div class="card rounded-xl p-5">
                            <h3 class="text-sm font-semibold text-white mb-4 flex items-center gap-2">
                                <span>üåç</span> Top Countries (30d)
                            </h3>
                            <div id="top-countries" class="space-y-2">
                                <div class="text-center text-gray-600 text-sm py-4">Loading‚Ä¶</div>
                            </div>
                        </div>

                        <!-- Top Pages -->
                        <div class="card rounded-xl p-5">
                            <h3 class="text-sm font-semibold text-white mb-4 flex items-center gap-2">
                                <span>üìÑ</span> Top Pages (30d)
                            </h3>
                            <div id="top-pages" class="space-y-2">
                                <div class="text-center text-gray-600 text-sm py-4">Loading‚Ä¶</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Blacklist Tab -->
                <div id="tab-blacklist" class="hidden space-y-4">
                    <div class="card rounded-2xl p-5">
                        <h3 class="text-sm font-semibold text-white mb-4">Add to Blacklist</h3>
                        <div class="grid sm:grid-cols-4 gap-3">
                            <select id="bl-type"
                                class="bg-white/5 border border-white/10 text-white text-sm rounded-xl px-3 py-2.5 focus:outline-none">
                                <option value="ip">IP Address</option>
                                <option value="email">Email</option>
                            </select>
                            <input id="bl-value" type="text" placeholder="IP or email address"
                                class="sm:col-span-2 bg-white/5 border border-white/10 rounded-xl px-4 py-2.5 text-sm text-white placeholder-gray-600 focus:outline-none focus:border-emerald-500/50 transition-colors">
                            <button onclick="addBlacklist()"
                                class="bg-red-500/80 hover:bg-red-500 text-white font-medium px-4 rounded-xl text-sm transition-colors">Block</button>
                        </div>
                    </div>

                    <div class="card rounded-xl overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="border-b border-white/[.06]">
                                <tr>
                                    <th class="text-left text-xs text-gray-500 px-4 py-3">Type</th>
                                    <th class="text-left text-xs text-gray-500 px-4 py-3">Value</th>
                                    <th class="text-left text-xs text-gray-500 px-4 py-3">Reason</th>
                                    <th class="text-left text-xs text-gray-500 px-4 py-3">Added</th>
                                </tr>
                            </thead>
                            <tbody id="blacklist-tbody" class="text-gray-400">
                                <tr>
                                    <td colspan="4" class="py-8 text-center text-gray-600 text-sm">Loading‚Ä¶</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="/static/js/toast.js"></script>
    <script>
        let _adminKey = null;
        let _currentTab = 'overview';
        let _usersPage = 1;
        let _requestsChart = null;
        let _charactersChart = null;
        let _overviewChart = null;
        let _trafficChart = null;

        function apiHeaders() {
            return { 'Content-Type': 'application/json', 'X-Admin-Key': _adminKey };
        }

        async function doAdminLogin() {
            const key = document.getElementById('admin-key-input').value.trim();
            if (!key) { showToast('Enter admin key.', 'warning'); return; }

            try {
                const resp = await fetch('/api/v1/admin/stats', { headers: { 'X-Admin-Key': key } });
                if (!resp.ok) { showToast('Invalid admin key.', 'error'); return; }
                _adminKey = key;
                sessionStorage.setItem('eidos_admin_key', key);
                document.getElementById('admin-login').classList.add('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                document.getElementById('admin-panel').classList.add('flex');
                loadCurrentTab();
            } catch (e) {
                showToast('Connection failed.', 'error');
            }
        }

        function doAdminLogout() {
            _adminKey = null;
            sessionStorage.removeItem('eidos_admin_key');
            location.reload();
        }

        function showTab(tab, btn) {
            _currentTab = tab;
            ['overview', 'users', 'usage', 'analytics', 'blacklist'].forEach(t => {
                document.getElementById(`tab-${t}`).classList.add('hidden');
            });
            document.getElementById(`tab-${tab}`).classList.remove('hidden');

            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');

            document.getElementById('page-title').textContent =
                { overview: 'Overview', users: 'Users', usage: 'Usage Analytics', analytics: 'Website Analytics', blacklist: 'Blacklist' }[tab] || tab;

            loadCurrentTab();
        }

        function loadCurrentTab() {
            if (_currentTab === 'overview') loadStats();
            if (_currentTab === 'users') loadUsers();
            if (_currentTab === 'usage') loadUsage();
            if (_currentTab === 'analytics') loadAnalytics();
            if (_currentTab === 'blacklist') loadBlacklist();
        }

        async function loadStats() {
            try {
                const resp = await fetch('/api/v1/admin/stats', { headers: apiHeaders() });
                const d = await resp.json();
                
                // Main stats
                document.getElementById('s-total-users').textContent = d.total_users;
                document.getElementById('s-verified').textContent = d.verified_users;
                document.getElementById('s-api-keys').textContent = d.active_api_keys;
                document.getElementById('s-req-today').textContent = d.requests_today;
                document.getElementById('s-req-yday').textContent = d.requests_yesterday;
                
                // User activity stats
                const unverified = d.total_users - d.verified_users;
                const bannedUsers = 0; // TODO: Add banned count to API
                const verifyRate = d.total_users > 0 ? Math.round((d.verified_users / d.total_users) * 100) : 0;
                
                document.getElementById('s-unverified').textContent = unverified;
                document.getElementById('s-banned').textContent = bannedUsers;
                document.getElementById('s-verify-rate').textContent = `${verifyRate}%`;
                
                // API usage stats
                const avgReq = d.requests_yesterday > 0 ? Math.round((d.requests_today + d.requests_yesterday) / 2) : d.requests_today;
                const peakReq = Math.max(d.requests_today, d.requests_yesterday);
                const growth = d.requests_yesterday > 0 ? Math.round(((d.requests_today - d.requests_yesterday) / d.requests_yesterday) * 100) : 0;
                const growthEl = document.getElementById('s-growth');
                
                document.getElementById('s-avg-req').textContent = avgReq.toLocaleString();
                document.getElementById('s-peak-req').textContent = peakReq.toLocaleString();
                growthEl.textContent = `${growth > 0 ? '+' : ''}${growth}%`;
                growthEl.className = `font-mono ${growth > 0 ? 'text-emerald-400' : growth < 0 ? 'text-red-400' : 'text-gray-400'}`;
                
                // Cache stats
                const cachePercent = d.cache.max_size_gb > 0 ? Math.round((d.cache.size_mb / (d.cache.max_size_gb * 1024)) * 100) : 0;
                document.getElementById('s-cache-files').textContent = d.cache.files;
                document.getElementById('s-cache-size').textContent = `${d.cache.size_mb} MB`;
                document.getElementById('s-cache-percent').textContent = `${cachePercent}%`;
                
                // Load overview chart
                loadOverviewChart();
            } catch (e) { 
                showToast('Failed to load stats.', 'error'); 
            }
        }

        async function loadOverviewChart() {
            try {
                const resp = await fetch('/api/v1/admin/usage?days=7', { headers: apiHeaders() });
                const d = await resp.json();
                const rows = [...d.days].reverse();
                
                const labels = rows.map(r => {
                    const date = new Date(r.date);
                    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                });
                const requests = rows.map(r => r.requests);

                if (_overviewChart) {
                    _overviewChart.destroy();
                }

                const ctx = document.getElementById('overview-chart').getContext('2d');
                _overviewChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Requests',
                            data: requests,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 3,
                            pointHoverRadius: 5,
                            pointBackgroundColor: '#10b981',
                            pointBorderColor: '#030704',
                            pointBorderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#10b981',
                                bodyColor: '#e5e7eb',
                                borderColor: 'rgba(16, 185, 129, 0.2)',
                                borderWidth: 1,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    label: function(context) {
                                        return context.parsed.y.toLocaleString() + ' requests';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)',
                                    drawBorder: false
                                },
                                ticks: {
                                    color: '#6b7280',
                                    font: {
                                        size: 11
                                    }
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)',
                                    drawBorder: false
                                },
                                ticks: {
                                    color: '#6b7280',
                                    font: {
                                        size: 11
                                    },
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (e) {
                console.error('Failed to load overview chart:', e);
            }
        }

        async function loadUsers() {
            try {
                const search = document.getElementById('user-search')?.value || '';
                const resp = await fetch(`/api/v1/admin/users?page=${_usersPage}&per_page=20&search=${encodeURIComponent(search)}`, { headers: apiHeaders() });
                const d = await resp.json();
                document.getElementById('users-total').textContent = `${d.total} users`;

                if (d.users.length === 0) {
                    document.getElementById('users-tbody').innerHTML = `
                        <tr>
                            <td colspan="5" class="py-12 text-center">
                                <div class="text-gray-600 mb-2">üë•</div>
                                <div class="text-sm text-gray-500 mb-1">${search ? 'No users found' : 'No users yet'}</div>
                                <div class="text-xs text-gray-600">${search ? 'Try a different search term' : 'Users will appear here once they register'}</div>
                            </td>
                        </tr>
                    `;
                } else {
                    document.getElementById('users-tbody').innerHTML = d.users.map(u => `
                        <tr class="border-b border-white/[.03] hover:bg-white/[.02] transition-colors">
                          <td class="px-4 py-3">
                            <div class="text-sm text-gray-300">${u.email}</div>
                            <div class="text-xs text-gray-600">${u.full_name || ''}</div>
                          </td>
                          <td class="px-4 py-3">
                            <span class="${u.is_active ? 'text-emerald-400' : 'text-red-400'} text-xs">${u.is_active ? (u.is_verified ? 'Active' : 'Unverified') : 'Banned'}</span>
                          </td>
                          <td class="px-4 py-3 font-mono text-xs text-gray-400">${u.usage_today}</td>
                          <td class="px-4 py-3 text-xs text-gray-500">${u.created_at ? new Date(u.created_at).toLocaleDateString() : '‚Äî'}</td>
                          <td class="px-4 py-3 text-right space-x-2">
                            ${u.is_active ? `<button onclick="banUser('${u.uuid}','${u.email}')" class="text-xs text-amber-400 hover:text-amber-300 transition-colors">Ban</button>` : '<span class="text-xs text-gray-600">Banned</span>'}
                            <button onclick="deleteUser('${u.uuid}','${u.email}')" class="text-xs text-red-400 hover:text-red-300 transition-colors">Delete</button>
                          </td>
                        </tr>
                    `).join('');
                }
            } catch (e) { 
                showToast('Failed to load users.', 'error'); 
                document.getElementById('users-tbody').innerHTML = `
                    <tr>
                        <td colspan="5" class="py-8 text-center text-red-400 text-sm">Failed to load users</td>
                    </tr>
                `;
            }
        }

        async function banUser(uuid, email) {
            if (!confirm(`Ban user ${email}?\n\nThis will deactivate their account and disable their API key.`)) return;
            const resp = await fetch(`/api/v1/admin/users/${uuid}/ban`, { method: 'POST', headers: apiHeaders() });
            if (resp.ok) { showToast(`Banned ${email}`, 'success'); loadUsers(); }
            else showToast('Failed to ban user.', 'error');
        }

        async function deleteUser(uuid, email) {
            if (!confirm(`‚ö†Ô∏è PERMANENTLY DELETE user ${email}?\n\nThis will delete:\n- User account\n- API keys\n- Usage records\n- Audit logs\n- Login attempts\n\nThis action CANNOT be undone!`)) return;
            
            // Double confirmation for safety
            const confirmText = prompt(`Type "${email}" to confirm deletion:`);
            if (confirmText !== email) {
                showToast('Deletion cancelled - email did not match', 'warning');
                return;
            }
            
            const resp = await fetch(`/api/v1/admin/users/${uuid}`, { 
                method: 'DELETE', 
                headers: apiHeaders() 
            });
            
            if (resp.ok) { 
                showToast(`Permanently deleted ${email}`, 'success'); 
                loadUsers(); 
            } else {
                const err = await resp.json();
                showToast(err.message || 'Failed to delete user.', 'error');
            }
        }

        function prevPage() { if (_usersPage > 1) { _usersPage--; loadUsers(); } }
        function nextPage() { _usersPage++; loadUsers(); }

        async function loadUsage() {
            try {
                const days = document.getElementById('usage-days').value;
                const resp = await fetch(`/api/v1/admin/usage?days=${days}`, { headers: apiHeaders() });
                const d = await resp.json();
                const rows = [...d.days].reverse();
                
                // Calculate summary stats
                const totalReq = rows.reduce((sum, r) => sum + r.requests, 0);
                const totalChars = rows.reduce((sum, r) => sum + r.chars, 0);
                const avgReq = rows.length > 0 ? Math.round(totalReq / rows.length) : 0;
                
                document.getElementById('usage-total-req').textContent = totalReq.toLocaleString();
                document.getElementById('usage-total-chars').textContent = totalChars.toLocaleString();
                document.getElementById('usage-avg-req').textContent = avgReq.toLocaleString();
                
                // Update charts
                updateUsageCharts(rows);
                
                // Populate table
                if (rows.length === 0 || totalReq === 0) {
                    document.getElementById('usage-tbody').innerHTML = `
                        <tr>
                            <td colspan="4" class="py-12 text-center">
                                <div class="text-gray-600 mb-2">üìä</div>
                                <div class="text-sm text-gray-500 mb-1">No usage data yet</div>
                                <div class="text-xs text-gray-600">Usage statistics will appear here once users start making requests</div>
                            </td>
                        </tr>
                    `;
                } else {
                    document.getElementById('usage-tbody').innerHTML = rows.map(r => `
                        <tr class="border-b border-white/[.03] hover:bg-white/[.02] transition-colors">
                            <td class="px-4 py-3 font-mono text-xs text-gray-300">${r.date}</td>
                            <td class="px-4 py-3 font-mono text-xs text-gray-300">${r.requests.toLocaleString()}</td>
                            <td class="px-4 py-3 font-mono text-xs text-gray-400">${r.chars.toLocaleString()}</td>
                            <td class="px-4 py-3 font-mono text-xs text-gray-500">${r.unique_ips}</td>
                        </tr>
                    `).join('');
                }
            } catch (e) {
                showToast('Failed to load usage data.', 'error');
                document.getElementById('usage-tbody').innerHTML = `
                    <tr>
                        <td colspan="4" class="py-8 text-center text-red-400 text-sm">Failed to load usage data</td>
                    </tr>
                `;
            }
        }

        function updateUsageCharts(rows) {
            const labels = rows.map(r => {
                const date = new Date(r.date);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });
            const requests = rows.map(r => r.requests);
            const characters = rows.map(r => r.chars);

            // Chart.js default config for dark theme
            const chartConfig = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#10b981',
                        bodyColor: '#e5e7eb',
                        borderColor: 'rgba(16, 185, 129, 0.2)',
                        borderWidth: 1,
                        padding: 12,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y.toLocaleString();
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#6b7280',
                            font: {
                                size: 11
                            }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#6b7280',
                            font: {
                                size: 11
                            },
                            callback: function(value) {
                                return value.toLocaleString();
                            }
                        }
                    }
                }
            };

            // Requests Chart
            if (_requestsChart) {
                _requestsChart.destroy();
            }
            const reqCtx = document.getElementById('requests-chart').getContext('2d');
            _requestsChart = new Chart(reqCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Requests',
                        data: requests,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 3,
                        pointHoverRadius: 5,
                        pointBackgroundColor: '#10b981',
                        pointBorderColor: '#030704',
                        pointBorderWidth: 2
                    }]
                },
                options: chartConfig
            });

            // Characters Chart
            if (_charactersChart) {
                _charactersChart.destroy();
            }
            const charCtx = document.getElementById('characters-chart').getContext('2d');
            _charactersChart = new Chart(charCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Characters',
                        data: characters,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 3,
                        pointHoverRadius: 5,
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: '#030704',
                        pointBorderWidth: 2
                    }]
                },
                options: chartConfig
            });
        }

        async function loadBlacklist() {
            const resp = await fetch('/api/v1/admin/blacklist', { headers: apiHeaders() });
            const d = await resp.json();
            document.getElementById('blacklist-tbody').innerHTML = d.entries.length ? d.entries.map(e => `
      <tr class="border-b border-white/[.03]">
        <td class="px-4 py-3"><span class="text-xs ${e.type === 'ip' ? 'text-amber-400' : 'text-red-400'} font-mono uppercase">${e.type}</span></td>
        <td class="px-4 py-3 font-mono text-xs text-gray-300">${e.value}</td>
        <td class="px-4 py-3 text-xs text-gray-500">${e.reason || '‚Äî'}</td>
        <td class="px-4 py-3 text-xs text-gray-600">${e.created_at ? new Date(e.created_at).toLocaleDateString() : '‚Äî'}</td>
      </tr>
    `).join('') : '<tr><td colspan="4" class="py-8 text-center text-gray-600 text-sm">No blacklisted entries</td></tr>';
        }

        async function addBlacklist() {
            const type = document.getElementById('bl-type').value;
            const value = document.getElementById('bl-value').value.trim();
            if (!value) { showToast('Enter a value.', 'warning'); return; }
            const resp = await fetch('/api/v1/admin/blacklist', {
                method: 'POST', headers: apiHeaders(),
                body: JSON.stringify({ type, value }),
            });
            const d = await resp.json();
            showToast(d.message, resp.ok ? 'success' : 'error');
            if (resp.ok) { document.getElementById('bl-value').value = ''; loadBlacklist(); }
        }

        // ‚îÄ‚îÄ Analytics Functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const COUNTRY_NAMES = {
            'US': 'United States', 'ID': 'Indonesia', 'IN': 'India', 'CN': 'China',
            'BR': 'Brazil', 'PK': 'Pakistan', 'NG': 'Nigeria', 'BD': 'Bangladesh',
            'RU': 'Russia', 'MX': 'Mexico', 'JP': 'Japan', 'PH': 'Philippines',
            'EG': 'Egypt', 'ET': 'Ethiopia', 'VN': 'Vietnam', 'CD': 'DR Congo',
            'TR': 'Turkey', 'IR': 'Iran', 'DE': 'Germany', 'TH': 'Thailand',
            'GB': 'United Kingdom', 'FR': 'France', 'IT': 'Italy', 'ZA': 'South Africa',
            'MM': 'Myanmar', 'KR': 'South Korea', 'CO': 'Colombia', 'ES': 'Spain',
            'AR': 'Argentina', 'DZ': 'Algeria', 'SD': 'Sudan', 'UA': 'Ukraine',
            'UG': 'Uganda', 'IQ': 'Iraq', 'PL': 'Poland', 'CA': 'Canada',
            'MA': 'Morocco', 'SA': 'Saudi Arabia', 'UZ': 'Uzbekistan', 'PE': 'Peru',
            'MY': 'Malaysia', 'AF': 'Afghanistan', 'MZ': 'Mozambique', 'GH': 'Ghana',
            'YE': 'Yemen', 'NP': 'Nepal', 'VE': 'Venezuela', 'MG': 'Madagascar',
            'AU': 'Australia', 'KP': 'North Korea', 'TW': 'Taiwan', 'NE': 'Niger',
            'LK': 'Sri Lanka', 'BF': 'Burkina Faso', 'ML': 'Mali', 'RO': 'Romania',
            'MW': 'Malawi', 'CL': 'Chile', 'KZ': 'Kazakhstan', 'ZM': 'Zambia',
            'GT': 'Guatemala', 'EC': 'Ecuador', 'SY': 'Syria', 'NL': 'Netherlands',
            'SN': 'Senegal', 'KH': 'Cambodia', 'TD': 'Chad', 'SO': 'Somalia',
            'ZW': 'Zimbabwe', 'GN': 'Guinea', 'RW': 'Rwanda', 'BJ': 'Benin',
            'TN': 'Tunisia', 'BI': 'Burundi', 'BO': 'Bolivia', 'HT': 'Haiti',
            'BE': 'Belgium', 'JO': 'Jordan', 'CU': 'Cuba', 'SS': 'South Sudan',
            'DO': 'Dominican Republic', 'CZ': 'Czech Republic', 'SE': 'Sweden',
            'PT': 'Portugal', 'AZ': 'Azerbaijan', 'GR': 'Greece', 'HU': 'Hungary',
            'TJ': 'Tajikistan', 'BY': 'Belarus', 'AE': 'UAE', 'AT': 'Austria',
            'RS': 'Serbia', 'IL': 'Israel', 'CH': 'Switzerland', 'TG': 'Togo',
            'HK': 'Hong Kong', 'SG': 'Singapore', 'DK': 'Denmark', 'FI': 'Finland',
            'SK': 'Slovakia', 'NO': 'Norway', 'IE': 'Ireland', 'HR': 'Croatia',
            'NZ': 'New Zealand', 'BG': 'Bulgaria', 'CR': 'Costa Rica', 'LB': 'Lebanon',
            'PR': 'Puerto Rico', 'PS': 'Palestine', 'UY': 'Uruguay', 'PA': 'Panama',
            'MN': 'Mongolia', 'AM': 'Armenia', 'AL': 'Albania', 'LT': 'Lithuania',
            'JM': 'Jamaica', 'QA': 'Qatar', 'NA': 'Namibia', 'MK': 'North Macedonia',
            'BW': 'Botswana', 'SI': 'Slovenia', 'LV': 'Latvia', 'KW': 'Kuwait',
            'GM': 'Gambia', 'GA': 'Gabon', 'TT': 'Trinidad and Tobago', 'EE': 'Estonia',
            'MU': 'Mauritius', 'SZ': 'Eswatini', 'DJ': 'Djibouti', 'FJ': 'Fiji',
            'CY': 'Cyprus', 'RE': 'R√©union', 'GQ': 'Equatorial Guinea', 'BH': 'Bahrain',
            'ME': 'Montenegro', 'LU': 'Luxembourg', 'SR': 'Suriname', 'CV': 'Cape Verde',
            'MT': 'Malta', 'MV': 'Maldives', 'BN': 'Brunei', 'BZ': 'Belize',
            'IS': 'Iceland', 'BB': 'Barbados', 'PF': 'French Polynesia', 'VU': 'Vanuatu',
            'NC': 'New Caledonia', 'GY': 'Guyana', 'WS': 'Samoa', 'ST': 'S√£o Tom√© and Pr√≠ncipe',
            'LC': 'Saint Lucia', 'GD': 'Grenada', 'TO': 'Tonga', 'FM': 'Micronesia',
            'VC': 'Saint Vincent', 'KI': 'Kiribati', 'SC': 'Seychelles', 'AG': 'Antigua and Barbuda',
            'AD': 'Andorra', 'DM': 'Dominica', 'KN': 'Saint Kitts and Nevis', 'MH': 'Marshall Islands',
            'LI': 'Liechtenstein', 'MC': 'Monaco', 'SM': 'San Marino', 'PW': 'Palau',
            'TV': 'Tuvalu', 'NR': 'Nauru', 'VA': 'Vatican City'
        };

        async function loadAnalytics() {
            try {
                const period = document.getElementById('analytics-period').value;
                const resp = await fetch(`/api/v1/admin/analytics?period=${period}`, { headers: apiHeaders() });
                const d = await resp.json();
                
                // Update period labels
                const periodLabels = {
                    'daily': 'Last 30 days',
                    'weekly': 'Last 12 weeks',
                    'monthly': 'Last 12 months'
                };
                const periodLabel = periodLabels[period] || 'Last 30 days';
                document.getElementById('analytics-period-label').textContent = periodLabel;
                document.getElementById('analytics-period-label-2').textContent = periodLabel;
                
                // Update totals
                document.getElementById('analytics-total-views').textContent = d.totals.views.toLocaleString();
                document.getElementById('analytics-total-visitors').textContent = d.totals.visitors.toLocaleString();
                
                // Update traffic chart
                updateTrafficChart(d.traffic, period);
                
                // Update top countries
                const countriesHtml = d.top_countries.length > 0 ? d.top_countries.map((c, i) => `
                    <div class="flex items-center justify-between py-2 border-b border-white/[.03]">
                        <div class="flex items-center gap-3">
                            <span class="text-xs text-gray-600 font-mono w-6">#${i + 1}</span>
                            <span class="text-sm text-gray-300">${COUNTRY_NAMES[c.country] || c.country}</span>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="text-right">
                                <div class="text-sm text-emerald-400 font-mono">${c.views.toLocaleString()}</div>
                                <div class="text-xs text-gray-500">views</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-blue-400 font-mono">${c.visitors.toLocaleString()}</div>
                                <div class="text-xs text-gray-500">visitors</div>
                            </div>
                        </div>
                    </div>
                `).join('') : '<div class="text-center text-gray-600 text-sm py-4">No data yet</div>';
                document.getElementById('top-countries').innerHTML = countriesHtml;
                
                // Update top pages
                const pagesHtml = d.top_pages.length > 0 ? d.top_pages.map((p, i) => `
                    <div class="flex items-center justify-between py-2 border-b border-white/[.03]">
                        <div class="flex items-center gap-3 flex-1 min-w-0">
                            <span class="text-xs text-gray-600 font-mono w-6 flex-shrink-0">#${i + 1}</span>
                            <div class="flex flex-col min-w-0 flex-1">
                                <span class="text-sm text-gray-300 truncate">${p.path_name || p.path}</span>
                                ${p.path_name && p.path !== p.path_name ? `<span class="text-xs text-gray-600 font-mono truncate">${p.path}</span>` : ''}
                            </div>
                        </div>
                        <div class="flex items-center gap-4 flex-shrink-0">
                            <div class="text-right">
                                <div class="text-sm text-emerald-400 font-mono">${p.views.toLocaleString()}</div>
                                <div class="text-xs text-gray-500">views</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-blue-400 font-mono">${p.visitors.toLocaleString()}</div>
                                <div class="text-xs text-gray-500">visitors</div>
                            </div>
                        </div>
                    </div>
                `).join('') : '<div class="text-center text-gray-600 text-sm py-4">No data yet</div>';
                document.getElementById('top-pages').innerHTML = pagesHtml;
                
            } catch (e) {
                showToast('Failed to load analytics.', 'error');
                console.error('Analytics error:', e);
            }
        }

        function updateTrafficChart(traffic, period) {
            const labels = traffic.map(t => {
                if (period === 'daily') return t.date.substring(5); // MM-DD
                if (period === 'weekly') return t.week;
                return t.month;
            });
            const views = traffic.map(t => t.views);
            const visitors = traffic.map(t => t.visitors);

            if (_trafficChart) {
                _trafficChart.destroy();
            }

            const ctx = document.getElementById('traffic-chart').getContext('2d');
            _trafficChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Page Views',
                            data: views,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 3,
                            pointHoverRadius: 5,
                            pointBackgroundColor: '#10b981',
                            pointBorderColor: '#030704',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'Unique Visitors',
                            data: visitors,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 3,
                            pointHoverRadius: 5,
                            pointBackgroundColor: '#3b82f6',
                            pointBorderColor: '#030704',
                            pointBorderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#9ca3af',
                                font: { size: 12 },
                                usePointStyle: true,
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#10b981',
                            bodyColor: '#e5e7eb',
                            borderColor: 'rgba(16, 185, 129, 0.2)',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: { size: 11 }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: { size: 11 },
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }


        // Auto-login from session
        const savedKey = sessionStorage.getItem('eidos_admin_key');
        if (savedKey) {
            document.getElementById('admin-key-input').value = savedKey;
            doAdminLogin();
        }
    </script>
</body>
</html>
