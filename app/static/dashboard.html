<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ‚Äî eidosSpeech</title>
    <meta name="description" content="Manage your eidosSpeech API key, view usage, and access developer resources.">
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: { extend: { fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] }, colors: { brand: { 400: '#34d399', 500: '#10b981', 600: '#059669' } } } }
        }
    </script>
    <style>
        :root {
            color-scheme: dark;
        }

        body {
            background: #050a06;
            color: #e5e7eb;
        }

        .card {
            background: rgba(255, 255, 255, .04);
            border: 1px solid rgba(255, 255, 255, .08);
        }

        pre,
        code {
            font-family: 'JetBrains Mono', monospace;
        }

        .code-block {
            background: #0d1117;
            border: 1px solid #21262d;
        }

        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(8px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fade-in .4s ease forwards;
        }
    </style>
</head>

<body class="font-sans antialiased min-h-screen">

    <!-- ‚îÄ‚îÄ Navbar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <nav class="sticky top-0 z-40 border-b border-white/[.06]"
        style="background:rgba(5,10,6,.9);backdrop-filter:blur(16px)">
        <div class="max-w-5xl mx-auto px-4 h-14 flex items-center justify-between">
            <a href="/" class="flex items-center gap-2">
                <div
                    class="w-7 h-7 rounded-lg bg-brand-500 flex items-center justify-center text-white font-bold text-xs">
                    e</div>
                <span class="font-bold text-white">eidosSpeech</span>
            </a>
            <div class="flex items-center gap-4">
                <a href="/app" class="text-sm text-gray-400 hover:text-white transition-colors">TTS App</a>
                <span id="user-email" class="text-xs text-gray-600 hidden sm:block"></span>
                <button id="logout-btn"
                    class="text-sm text-gray-500 hover:text-white px-3 py-1.5 rounded-lg hover:bg-white/5 transition-colors">Sign
                    Out</button>
            </div>
        </div>
    </nav>

    <!-- ‚îÄ‚îÄ Auth Guard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div id="auth-guard" class="hidden min-h-screen flex items-center justify-center">
        <div class="text-center space-y-4">
            <div class="w-16 h-16 bg-white/5 rounded-2xl flex items-center justify-center mx-auto text-3xl">üîê</div>
            <h2 class="text-xl font-bold text-white">Authentication Required</h2>
            <p class="text-gray-400 text-sm">Please sign in to access your dashboard.</p>
            <a href="/app#login"
                class="inline-block bg-brand-500 hover:bg-brand-400 text-white font-semibold px-6 py-2.5 rounded-xl transition-colors">Sign
                In</a>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ Dashboard Content ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <main id="dashboard-content" class="hidden max-w-5xl mx-auto px-4 py-8 fade-in">
        <!-- Page Header -->
        <div class="mb-8">
            <h1 class="text-2xl font-bold text-white">Dashboard</h1>
            <p class="text-gray-500 text-sm mt-1">Manage your API key and monitor usage</p>
        </div>

        <!-- Stats Row -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="card rounded-2xl p-5 text-center">
                <div id="stat-req-today" class="text-3xl font-black text-brand-400">‚Äî</div>
                <div class="text-xs text-gray-500 mt-1">Requests Today</div>
            </div>
            <div class="card rounded-2xl p-5 text-center">
                <div id="stat-req-limit" class="text-3xl font-black text-gray-400">30</div>
                <div class="text-xs text-gray-500 mt-1">Daily Limit</div>
            </div>
            <div class="card rounded-2xl p-5 text-center">
                <div id="stat-chars-today" class="text-3xl font-black text-brand-400">‚Äî</div>
                <div class="text-xs text-gray-500 mt-1">Chars Today</div>
            </div>
            <div class="card rounded-2xl p-5 text-center">
                <div id="stat-chars-limit" class="text-3xl font-black text-gray-400">2,000</div>
                <div class="text-xs text-gray-500 mt-1">Char Limit</div>
            </div>
        </div>

        <div class="grid lg:grid-cols-[1fr_340px] gap-6">

            <!-- Left Column -->
            <div class="space-y-6">

                <!-- API Key Card -->
                <div class="card rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="font-semibold text-white">API Key</h2>
                        <span
                            class="text-xs bg-brand-500/10 text-brand-400 border border-brand-500/20 px-2.5 py-1 rounded-full font-mono">esk_***</span>
                    </div>

                    <div class="code-block rounded-xl px-4 py-3 flex items-center gap-3 mb-4">
                        <code id="api-key-full"
                            class="flex-1 text-sm text-brand-400 overflow-hidden text-ellipsis whitespace-nowrap">Loading‚Ä¶</code>
                        <button id="toggle-key-btn" onclick="toggleKeyVisibility()"
                            class="flex-shrink-0 text-xs text-gray-500 hover:text-gray-300 transition-colors">Show</button>
                        <button onclick="copyApiKey()"
                            class="flex-shrink-0 text-xs text-gray-500 hover:text-gray-300 transition-colors">Copy</button>
                    </div>

                    <div class="flex items-center gap-3">
                        <button id="regen-btn" onclick="regenKey()"
                            class="flex-1 text-sm bg-white/5 hover:bg-white/10 border border-white/10 text-gray-300 hover:text-white py-2.5 rounded-xl transition-colors">
                            ‚Üª Regenerate Key
                        </button>
                    </div>
                    <p class="text-xs text-gray-600 mt-3">Regenerating your key immediately invalidates the old one.
                        5-minute cooldown between regenerations.</p>
                </div>

                <!-- Quick Start Code Snippets -->
                <div class="card rounded-2xl p-6">
                    <h2 class="font-semibold text-white mb-4">Quick Start</h2>

                    <!-- Tab buttons -->
                    <div class="flex gap-1 mb-4 p-1 bg-black/30 rounded-xl">
                        <button
                            class="snippet-tab active flex-1 text-xs py-1.5 rounded-lg text-white bg-white/10 font-medium transition-colors"
                            onclick="showSnippet('curl', this)">cURL</button>
                        <button
                            class="snippet-tab flex-1 text-xs py-1.5 rounded-lg text-gray-500 font-medium transition-colors hover:text-gray-300"
                            onclick="showSnippet('python', this)">Python</button>
                        <button
                            class="snippet-tab flex-1 text-xs py-1.5 rounded-lg text-gray-500 font-medium transition-colors hover:text-gray-300"
                            onclick="showSnippet('js', this)">JavaScript</button>
                        <button
                            class="snippet-tab flex-1 text-xs py-1.5 rounded-lg text-gray-500 font-medium transition-colors hover:text-gray-300"
                            onclick="showSnippet('php', this)">PHP</button>
                    </div>

                    <!-- Snippets -->
                    <div class="relative">
                        <button onclick="copyCurrentSnippet()"
                            class="absolute top-3 right-3 text-xs text-gray-600 hover:text-gray-400 transition-colors z-10">Copy</button>

                        <pre id="snippet-curl"
                            class="code-block rounded-xl p-4 text-xs text-gray-300 overflow-x-auto leading-relaxed"><code class="text-brand-400">curl</code> <span class="text-gray-400">-X POST https://eidosspeech.xyz/api/v1/tts</span> \
  <code class="text-gray-400">-H</code> <code class="text-emerald-400">"X-API-Key: <span class="api-key-placeholder">YOUR_API_KEY</span>"</code> \
  <code class="text-gray-400">-H</code> <code class="text-emerald-400">"Content-Type: application/json"</code> \
  <code class="text-gray-400">-d</code> <code class="text-blue-400">'{
    "text": "Hello world!",
    "voice": "en-US-JennyNeural",
    "rate": "+0%",
    "pitch": "+0Hz"
  }'</code> \
  <code class="text-gray-400">--output audio.mp3</code></pre>

                        <pre id="snippet-python"
                            class="code-block rounded-xl p-4 text-xs text-gray-300 overflow-x-auto leading-relaxed hidden"><code class="text-blue-400">import</code> requests

response = requests.<code class="text-brand-400">post</code>(
    <code class="text-emerald-400">"https://eidosspeech.xyz/api/v1/tts"</code>,
    headers={<code class="text-emerald-400">"X-API-Key"</code>: <code class="text-emerald-400">"<span class='api-key-placeholder'>YOUR_API_KEY</span>"</code>},
    json={
        <code class="text-emerald-400">"text"</code>: <code class="text-emerald-400">"Hello world!"</code>,
        <code class="text-emerald-400">"voice"</code>: <code class="text-emerald-400">"en-US-JennyNeural"</code>,
    }
)

<code class="text-blue-400">with</code> <code class="text-brand-400">open</code>(<code class="text-emerald-400">"audio.mp3"</code>, <code class="text-emerald-400">"wb"</code>) <code class="text-blue-400">as</code> f:
    f.<code class="text-brand-400">write</code>(response.content)

<code class="text-gray-500"># Rate limit headers</code>
<code class="text-brand-400">print</code>(response.headers[<code class="text-emerald-400">"X-RateLimit-Remaining-Day"</code>])</pre>

                        <pre id="snippet-js"
                            class="code-block rounded-xl p-4 text-xs text-gray-300 overflow-x-auto leading-relaxed hidden"><code class="text-blue-400">const</code> response = <code class="text-blue-400">await</code> <code class="text-brand-400">fetch</code>(<code class="text-emerald-400">'https://eidosspeech.xyz/api/v1/tts'</code>, {
  method: <code class="text-emerald-400">'POST'</code>,
  headers: {
    <code class="text-emerald-400">'X-API-Key'</code>: <code class="text-emerald-400">'<span class="api-key-placeholder">YOUR_API_KEY</span>'</code>,
    <code class="text-emerald-400">'Content-Type'</code>: <code class="text-emerald-400">'application/json'</code>,
  },
  body: <code class="text-brand-400">JSON.stringify</code>({
    text: <code class="text-emerald-400">'Hello world!'</code>,
    voice: <code class="text-emerald-400">'en-US-JennyNeural'</code>,
  }),
});

<code class="text-blue-400">const</code> blob = <code class="text-blue-400">await</code> response.<code class="text-brand-400">blob</code>();
<code class="text-blue-400">const</code> url = URL.<code class="text-brand-400">createObjectURL</code>(blob);
<code class="text-gray-500">// Play or download audio‚Ä¶</code></pre>

                        <pre id="snippet-php"
                            class="code-block rounded-xl p-4 text-xs text-gray-300 overflow-x-auto leading-relaxed hidden"><code class="text-blue-400">&lt;?php</code>
<code class="text-brand-400">$ch</code> = curl_init(<code class="text-emerald-400">'https://eidosspeech.xyz/api/v1/tts'</code>);
curl_setopt_array(<code class="text-brand-400">$ch</code>, [
  CURLOPT_POST         => <code class="text-blue-400">true</code>,
  CURLOPT_HTTPHEADER   => [
    <code class="text-emerald-400">'X-API-Key: <span class="api-key-placeholder">YOUR_API_KEY</span>'</code>,
    <code class="text-emerald-400">'Content-Type: application/json'</code>,
  ],
  CURLOPT_POSTFIELDS   => json_encode([
    <code class="text-emerald-400">'text'</code>  => <code class="text-emerald-400">'Hello world!'</code>,
    <code class="text-emerald-400">'voice'</code> => <code class="text-emerald-400">'en-US-JennyNeural'</code>,
  ]),
  CURLOPT_RETURNTRANSFER => <code class="text-blue-400">true</code>,
]);
<code class="text-brand-400">$audio</code> = curl_exec(<code class="text-brand-400">$ch</code>);
file_put_contents(<code class="text-emerald-400">'audio.mp3'</code>, <code class="text-brand-400">$audio</code>);</pre>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-6">

                <!-- Account Info -->
                <div class="card rounded-2xl p-6">
                    <h2 class="font-semibold text-white mb-4">Account</h2>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-gray-500">Email</span>
                            <span id="account-email" class="text-xs text-gray-300">‚Äî</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-gray-500">Status</span>
                            <span
                                class="text-xs text-brand-400 bg-brand-500/10 border border-brand-500/20 px-2 py-0.5 rounded-full">Verified</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-gray-500">Tier</span>
                            <span class="text-xs text-gray-300 font-mono">registered-free</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-gray-500">Joined</span>
                            <span id="account-joined" class="text-xs text-gray-300">‚Äî</span>
                        </div>
                    </div>
                </div>

                <!-- Usage Progress -->
                <div class="card rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="font-semibold text-white">Daily Usage</h2>
                        <span class="text-xs text-gray-600">Resets at UTC midnight</span>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-xs text-gray-500 mb-2">
                                <span>Requests</span>
                                <span><span id="dash-req">0</span> / <span id="dash-req-limit">30</span></span>
                            </div>
                            <div class="h-2 rounded-full bg-white/5">
                                <div id="dash-req-bar" class="h-full rounded-full bg-brand-500 transition-all"
                                    style="width:0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs text-gray-500 mb-2">
                                <span>Characters</span>
                                <span><span id="dash-chars">0</span> / <span id="dash-chars-limit">2,000</span></span>
                            </div>
                            <div class="h-2 rounded-full bg-white/5">
                                <div id="dash-chars-bar" class="h-full rounded-full bg-brand-500 transition-all"
                                    style="width:0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Links -->
                <div class="card rounded-2xl p-6">
                    <h2 class="font-semibold text-white mb-4">Resources</h2>
                    <div class="space-y-2">
                        <a href="/app"
                            class="flex items-center justify-between p-3 rounded-xl hover:bg-white/5 transition-colors group">
                            <span class="text-sm text-gray-400 group-hover:text-white transition-colors">TTS App</span>
                            <span class="text-gray-600 group-hover:text-gray-400 transition-colors">‚Üí</span>
                        </a>
                        <a href="/api-docs"
                            class="flex items-center justify-between p-3 rounded-xl hover:bg-white/5 transition-colors group">
                            <span class="text-sm text-gray-400 group-hover:text-white transition-colors">API
                                Documentation</span>
                            <span class="text-gray-600 group-hover:text-gray-400 transition-colors">‚Üí</span>
                        </a>
                        <a href="/tos"
                            class="flex items-center justify-between p-3 rounded-xl hover:bg-white/5 transition-colors group">
                            <span class="text-sm text-gray-400 group-hover:text-white transition-colors">Terms of
                                Service</span>
                            <span class="text-gray-600 group-hover:text-gray-400 transition-colors">‚Üí</span>
                        </a>
                        <a href="/privacy"
                            class="flex items-center justify-between p-3 rounded-xl hover:bg-white/5 transition-colors group">
                            <span class="text-sm text-gray-400 group-hover:text-white transition-colors">Privacy
                                Policy</span>
                            <span class="text-gray-600 group-hover:text-gray-400 transition-colors">‚Üí</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="/static/js/toast.js"></script>
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/api-client.js"></script>
    <script>
        let _apiKey = null;
        let _keyVisible = false;
        let _currentSnippet = 'curl';

        async function init() {
            await AuthStore.init();

            if (!AuthStore.isAuthenticated()) {
                document.getElementById('auth-guard').classList.remove('hidden');
                return;
            }

            document.getElementById('dashboard-content').classList.remove('hidden');

            const user = AuthStore.getUser();
            if (user?.email) {
                document.getElementById('user-email').textContent = user.email;
                document.getElementById('account-email').textContent = user.email;
            }

            // Fetch full user data
            try {
                const data = await ApiClient.auth.me();
                if (data.user) {
                    const u = data.user;
                    _apiKey = u.api_key;
                    document.getElementById('api-key-full').textContent = maskKey(_apiKey);

                    if (u.created_at) {
                        document.getElementById('account-joined').textContent = new Date(u.created_at).toLocaleDateString();
                    }

                    // Replace placeholder API keys in code snippets
                    document.querySelectorAll('.api-key-placeholder').forEach(el => {
                        el.textContent = _apiKey || 'YOUR_API_KEY';
                    });

                    if (u.usage) {
                        updateUsage(u.usage);
                    }
                }
            } catch (e) {
                showToast('Failed to load user data.', 'error');
            }

            // Logout
            document.getElementById('logout-btn').addEventListener('click', async () => {
                await ApiClient.auth.logout();
                window.location.href = '/';
            });
        }

        function updateUsage(u) {
            document.getElementById('stat-req-today').textContent = u.requests;
            document.getElementById('stat-req-limit').textContent = u.requests_limit;
            document.getElementById('stat-chars-today').textContent = u.chars.toLocaleString();
            document.getElementById('stat-chars-limit').textContent = u.chars_limit.toLocaleString();
            document.getElementById('dash-req').textContent = u.requests;
            document.getElementById('dash-req-limit').textContent = u.requests_limit;
            document.getElementById('dash-chars').textContent = u.chars.toLocaleString();
            document.getElementById('dash-chars-limit').textContent = u.chars_limit.toLocaleString();

            const rPct = Math.min(100, (u.requests / u.requests_limit) * 100);
            const cPct = Math.min(100, (u.chars / u.chars_limit) * 100);
            document.getElementById('dash-req-bar').style.width = rPct + '%';
            document.getElementById('dash-req-bar').className = `h-full rounded-full transition-all ${rPct > 90 ? 'bg-red-500' : rPct > 70 ? 'bg-amber-500' : 'bg-brand-500'}`;
            document.getElementById('dash-chars-bar').style.width = cPct + '%';
        }

        function maskKey(key) {
            if (!key) return '‚Äî';
            return key.substring(0, 8) + '‚Ä¢'.repeat(16) + key.slice(-6);
        }

        function toggleKeyVisibility() {
            _keyVisible = !_keyVisible;
            document.getElementById('api-key-full').textContent = _keyVisible ? _apiKey : maskKey(_apiKey);
            document.getElementById('toggle-key-btn').textContent = _keyVisible ? 'Hide' : 'Show';
        }

        async function copyApiKey() {
            if (!_apiKey) return;
            await navigator.clipboard.writeText(_apiKey).catch(() => { });
            showToast('API key copied!', 'success', 2000);
        }

        async function regenKey() {
            if (!confirm('Regenerate your API key? The old key will stop working immediately.')) return;
            const btn = document.getElementById('regen-btn');
            btn.disabled = true;
            btn.textContent = 'Regenerating‚Ä¶';
            try {
                const data = await ApiClient.auth.regenKey();
                _apiKey = data.api_key;
                document.getElementById('api-key-full').textContent = maskKey(_apiKey);
                _keyVisible = false;
                document.getElementById('toggle-key-btn').textContent = 'Show';
                document.querySelectorAll('.api-key-placeholder').forEach(el => { el.textContent = _apiKey; });
                showToast('API key regenerated!', 'success');
            } catch (e) {
                showToast(e.message || 'Failed to regenerate key.', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = '‚Üª Regenerate Key';
            }
        }

        function showSnippet(lang, btn) {
            _currentSnippet = lang;
            ['curl', 'python', 'js', 'php'].forEach(l => {
                document.getElementById(`snippet-${l}`).classList.add('hidden');
            });
            document.getElementById(`snippet-${lang}`).classList.remove('hidden');
            document.querySelectorAll('.snippet-tab').forEach(t => {
                t.classList.remove('active', 'text-white', 'bg-white/10');
                t.classList.add('text-gray-500');
            });
            btn.classList.add('text-white', 'bg-white/10');
            btn.classList.remove('text-gray-500');
        }

        async function copyCurrentSnippet() {
            const el = document.getElementById(`snippet-${_currentSnippet}`);
            const text = el.textContent;
            await navigator.clipboard.writeText(text).catch(() => { });
            showToast('Copied!', 'success', 2000);
        }

        init();
    </script>
</body>

</html>